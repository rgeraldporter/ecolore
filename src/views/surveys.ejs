<!DOCTYPE html>
<html lang="en">

<% include head %>

    <body>
        <% include menu %>
            <div class="content-wrapper">
                <div class="header">
                </div>
                <div class="content pure-g">

                    <% include project-menu %>
                    <% const isAdmin = project.memberRole === 'administrator' || project.memberRole === 'owner'; %>
                    <% const isContrib = project.memberRole === 'administrator' || project.memberRole === 'owner'
                    || project.memberRole === 'contributor'; %>

                    <main class="pure-u-1 pure-u-md-4-5">

                            <h2><%= cycle.title %> Surveys</h2>
                        <aside>
                            <% if(isContrib) { %>
                                <a href='/project/<%= projectSlug %>/cycle/<%= cycle.id %>/survey/new'>Submit survey</a><br>
                            <% } %>
                            <a href='/project/<%= projectSlug %>/cycles'>Return to list of <%= locals.t('cycles', project) %></a>
                        </aside>
                        <% if(isContrib) { %>
                            <% if ( !filter ) { %>
                                All surveys for <%= cycle.title %> are shown below. <a href='/project/<%= projectSlug %>/cycle/<%= cycle.id %>/surveys?filter=needs_review'>Show only unreviewed surveys</a><br>
                            <% } %>
                            <% if ( filter ) { %>
                                Only unreviewed surveys for <%= cycle.title %> are being shown below. <a href='/project/<%= projectSlug %>/cycle/<%= cycle.id %>/surveys'>Show all surveys</a><br>
                            <% } %>
                        <% } %>
                        <table class="pure-table pure-table-horizontal">
                            <thead>
                                <tr><th>#</th><th>Start</th><th>End</th><th></th>
                                <% if(isAdmin) { %>
                                    <th></th>
                                <% } %>
                                <th><%= locals.t('Observations', project) %></th>
                                <th>Submitted by</th><th>Submission date</th></tr>
                            </thead>
                            <tbody>
                            <%
                                surveys.forEach(survey => {
                                    if ( filter ) {
                                        if ( filter === 'needs_review' ) {
                                            if ( survey.get('reviewCount') ) {
                                                return;
                                            }
                                        }
                                    }
                            %>
                                <tr>
                                    <td><%= survey.id %></td>
                                    <td><%= moment(survey.start).format('MMM Do YYYY, h:mm a') %></td>
                                    <td><%= moment(survey.end).format('MMM Do YYYY, h:mm a') %></td>
                                    <td><a href="/project/<%= projectSlug %>/cycle/<%= cycle.id %>/survey/<%= survey.id %>">View data</a></td>
                                    <% if(isAdmin && !survey.get('reviewCount')) { %>
                                        <td><a href="/project/<%= projectSlug %>/cycle/<%= cycle.id %>/survey/<%= survey.id %>/review">
                                            Review data
                                        </a></td>
                                    <% } else if (isAdmin) { %>
                                        <td><a href="/project/<%= projectSlug %>/cycle/<%= cycle.id %>/survey/<%= survey.id %>/reviews">
                                            Reviews: <%= survey.get('reviewCount') %>
                                        </a></td>
                                    <% } %>
                                    <td><a href="/project/<%= projectSlug %>/cycle/<%= cycle.id %>/survey/<%= survey.id %>/observations"><%= survey.get('observationCount') %> <%= locals.t('records', project) %></a></td>
                                    <td><%= survey.author.firstName %> <%= survey.author.lastName %></td>
                                    <td><%= moment(survey.createdAt).format('MMM Do YYYY, h:mm a') %></td>
                                </tr>
                            <% }); %>
                            </tbody>
                        </table>
                    </main>

                </div>
                <% include footer %>
            </div>
    </body>

</html>